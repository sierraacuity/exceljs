{"version":3,"file":"table-xform.js","names":["XmlStream","require","BaseXform","ListXform","AutoFilterXform","TableColumnXform","TableStyleInfoXform","TableXform","_BaseXform","_inherits","_super","_createSuper","_this","_classCallCheck","call","map","autoFilter","tableColumns","tag","count","empty","childXform","tableStyleInfo","_createClass","key","value","prepare","model","options","columns","get","render","xmlStream","openXml","StdDocAttributes","openNode","_objectSpread","TABLE_ATTRIBUTES","id","name","displayName","ref","tableRef","totalsRowCount","totalsRow","undefined","totalsRowShown","headerRowCount","headerRow","style","closeNode","parseOpen","node","parser","attributes","reset","parseText","text","parseClose","_this2","autoFilterRef","forEach","column","index","filterButton","reconcile","dxfId","styles","getDxfStyle","xmlns","module","exports"],"sources":["../../../../../lib/xlsx/xform/table/table-xform.js"],"sourcesContent":["const XmlStream = require('../../../utils/xml-stream');\r\n\r\nconst BaseXform = require('../base-xform');\r\nconst ListXform = require('../list-xform');\r\n\r\nconst AutoFilterXform = require('./auto-filter-xform');\r\nconst TableColumnXform = require('./table-column-xform');\r\nconst TableStyleInfoXform = require('./table-style-info-xform');\r\n\r\nclass TableXform extends BaseXform {\r\n  constructor() {\r\n    super();\r\n\r\n    this.map = {\r\n      autoFilter: new AutoFilterXform(),\r\n      tableColumns: new ListXform({\r\n        tag: 'tableColumns',\r\n        count: true,\r\n        empty: true,\r\n        childXform: new TableColumnXform(),\r\n      }),\r\n      tableStyleInfo: new TableStyleInfoXform(),\r\n    };\r\n  }\r\n\r\n  prepare(model, options) {\r\n    this.map.autoFilter.prepare(model);\r\n    this.map.tableColumns.prepare(model.columns, options);\r\n  }\r\n\r\n  get tag() {\r\n    return 'table';\r\n  }\r\n\r\n  render(xmlStream, model) {\r\n    xmlStream.openXml(XmlStream.StdDocAttributes);\r\n    xmlStream.openNode(this.tag, {\r\n      ...TableXform.TABLE_ATTRIBUTES,\r\n      id: model.id,\r\n      name: model.name,\r\n      displayName: model.displayName || model.name,\r\n      ref: model.tableRef,\r\n      totalsRowCount: model.totalsRow ? '1' : undefined,\r\n      totalsRowShown: model.totalsRow ? undefined : '1',\r\n      headerRowCount: model.headerRow ? '1' : '0',\r\n    });\r\n\r\n    this.map.autoFilter.render(xmlStream, model);\r\n    this.map.tableColumns.render(xmlStream, model.columns);\r\n    this.map.tableStyleInfo.render(xmlStream, model.style);\r\n\r\n    xmlStream.closeNode();\r\n  }\r\n\r\n  parseOpen(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n    const {name, attributes} = node;\r\n    switch (name) {\r\n      case this.tag:\r\n        this.reset();\r\n        this.model = {\r\n          name: attributes.name,\r\n          displayName: attributes.displayName || attributes.name,\r\n          tableRef: attributes.ref,\r\n          totalsRow: attributes.totalsRowCount === '1',\r\n          headerRow: attributes.headerRowCount === '1',\r\n        };\r\n        break;\r\n      default:\r\n        this.parser = this.map[node.name];\r\n        if (this.parser) {\r\n          this.parser.parseOpen(node);\r\n        }\r\n        break;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  parseText(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  }\r\n\r\n  parseClose(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.parser = undefined;\r\n      }\r\n      return true;\r\n    }\r\n    switch (name) {\r\n      case this.tag:\r\n        this.model.columns = this.map.tableColumns.model;\r\n        if (this.map.autoFilter.model) {\r\n          this.model.autoFilterRef = this.map.autoFilter.model.autoFilterRef;\r\n          this.map.autoFilter.model.columns.forEach((column, index) => {\r\n            this.model.columns[index].filterButton = column.filterButton;\r\n          });\r\n        }\r\n        this.model.style = this.map.tableStyleInfo.model;\r\n        return false;\r\n      default:\r\n        // could be some unrecognised tags\r\n        return true;\r\n    }\r\n  }\r\n\r\n  reconcile(model, options) {\r\n    // fetch the dfxs from styles\r\n    model.columns.forEach(column => {\r\n      if (column.dxfId !== undefined) {\r\n        column.style = options.styles.getDxfStyle(column.dxfId);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nTableXform.TABLE_ATTRIBUTES = {\r\n  xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\r\n  'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\r\n  'mc:Ignorable': 'xr xr3',\r\n  'xmlns:xr': 'http://schemas.microsoft.com/office/spreadsheetml/2014/revision',\r\n  'xmlns:xr3': 'http://schemas.microsoft.com/office/spreadsheetml/2016/revision3',\r\n  // 'xr:uid': '{00000000-000C-0000-FFFF-FFFF00000000}',\r\n};\r\n\r\nmodule.exports = TableXform;\r\n"],"mappings":"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"}