{"version":3,"file":"conditional-formattings-xform.js","names":["BaseXform","require","ConditionalFormattingXform","ConditionalFormattingsXform","_BaseXform","_inherits","_super","_createSuper","_this","_classCallCheck","call","cfXform","_createClass","key","get","value","reset","model","prepare","options","nextPriority","reduce","p","cf","Math","max","apply","concat","_toConsumableArray","rules","map","rule","priority","forEach","style","dxfId","styles","addDxfStyle","render","xmlStream","_this2","parseOpen","node","parser","name","parseText","text","parseClose","push","undefined","reconcile","getDxfStyle","module","exports"],"sources":["../../../../../../lib/xlsx/xform/sheet/cf/conditional-formattings-xform.js"],"sourcesContent":["const BaseXform = require('../../base-xform');\r\n\r\nconst ConditionalFormattingXform = require('./conditional-formatting-xform');\r\n\r\nclass ConditionalFormattingsXform extends BaseXform {\r\n  constructor() {\r\n    super();\r\n\r\n    this.cfXform = new ConditionalFormattingXform();\r\n  }\r\n\r\n  get tag() {\r\n    return 'conditionalFormatting';\r\n  }\r\n\r\n  reset() {\r\n    this.model = [];\r\n  }\r\n\r\n  prepare(model, options) {\r\n    // ensure each rule has a priority value\r\n    let nextPriority = model.reduce(\r\n      (p, cf) => Math.max(p, ...cf.rules.map(rule => rule.priority || 0)),\r\n      1\r\n    );\r\n    model.forEach(cf => {\r\n      cf.rules.forEach(rule => {\r\n        if (!rule.priority) {\r\n          rule.priority = nextPriority++;\r\n        }\r\n\r\n        if (rule.style) {\r\n          rule.dxfId = options.styles.addDxfStyle(rule.style);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  render(xmlStream, model) {\r\n    model.forEach(cf => {\r\n      this.cfXform.render(xmlStream, cf);\r\n    });\r\n  }\r\n\r\n  parseOpen(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n\r\n    switch (node.name) {\r\n      case 'conditionalFormatting':\r\n        this.parser = this.cfXform;\r\n        this.parser.parseOpen(node);\r\n        return true;\r\n\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  parseText(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  }\r\n\r\n  parseClose(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.model.push(this.parser.model);\r\n        this.parser = undefined;\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  reconcile(model, options) {\r\n    model.forEach(cf => {\r\n      cf.rules.forEach(rule => {\r\n        if (rule.dxfId !== undefined) {\r\n          rule.style = options.styles.getDxfStyle(rule.dxfId);\r\n          delete rule.dxfId;\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = ConditionalFormattingsXform;\r\n"],"mappings":"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"}