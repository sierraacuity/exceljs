{"version":3,"file":"sheet-view-xform.js","names":["colCache","require","BaseXform","VIEW_STATES","frozen","frozenSplit","split","SheetViewXform","_BaseXform","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","get","value","prepare","model","state","render","xmlStream","openNode","workbookViewId","add","name","included","addAttribute","rightToLeft","tabSelected","showRuler","showRowColHeaders","showGridLines","zoomScale","zoomScaleNormal","style","topLeftCell","xSplit","ySplit","activePane","getAddress","address","leafNode","undefined","pane","activeCell","sqref","closeNode","parseOpen","node","sheetView","parseInt","attributes","view","selections","parseText","parseClose","selection","topLeft","reconcile","module","exports"],"sources":["../../../../../lib/xlsx/xform/sheet/sheet-view-xform.js"],"sourcesContent":["const colCache = require('../../../utils/col-cache');\r\nconst BaseXform = require('../base-xform');\r\n\r\nconst VIEW_STATES = {\r\n  frozen: 'frozen',\r\n  frozenSplit: 'frozen',\r\n  split: 'split',\r\n};\r\n\r\nclass SheetViewXform extends BaseXform {\r\n  get tag() {\r\n    return 'sheetView';\r\n  }\r\n\r\n  prepare(model) {\r\n    switch (model.state) {\r\n      case 'frozen':\r\n      case 'split':\r\n        break;\r\n      default:\r\n        model.state = 'normal';\r\n        break;\r\n    }\r\n  }\r\n\r\n  render(xmlStream, model) {\r\n    xmlStream.openNode('sheetView', {\r\n      workbookViewId: model.workbookViewId || 0,\r\n    });\r\n    const add = function(name, value, included) {\r\n      if (included) {\r\n        xmlStream.addAttribute(name, value);\r\n      }\r\n    };\r\n    add('rightToLeft', '1', model.rightToLeft === true);\r\n    add('tabSelected', '1', model.tabSelected);\r\n    add('showRuler', '0', model.showRuler === false);\r\n    add('showRowColHeaders', '0', model.showRowColHeaders === false);\r\n    add('showGridLines', '0', model.showGridLines === false);\r\n    add('zoomScale', model.zoomScale, model.zoomScale);\r\n    add('zoomScaleNormal', model.zoomScaleNormal, model.zoomScaleNormal);\r\n    add('view', model.style, model.style);\r\n\r\n    let topLeftCell;\r\n    let xSplit;\r\n    let ySplit;\r\n    let activePane;\r\n    switch (model.state) {\r\n      case 'frozen':\r\n        xSplit = model.xSplit || 0;\r\n        ySplit = model.ySplit || 0;\r\n        topLeftCell = model.topLeftCell || colCache.getAddress(ySplit + 1, xSplit + 1).address;\r\n        activePane =\r\n          (model.xSplit && model.ySplit && 'bottomRight') ||\r\n          (model.xSplit && 'topRight') ||\r\n          'bottomLeft';\r\n\r\n        xmlStream.leafNode('pane', {\r\n          xSplit: model.xSplit || undefined,\r\n          ySplit: model.ySplit || undefined,\r\n          topLeftCell,\r\n          activePane,\r\n          state: 'frozen',\r\n        });\r\n        xmlStream.leafNode('selection', {\r\n          pane: activePane,\r\n          activeCell: model.activeCell,\r\n          sqref: model.activeCell,\r\n        });\r\n        break;\r\n      case 'split':\r\n        if (model.activePane === 'topLeft') {\r\n          model.activePane = undefined;\r\n        }\r\n        xmlStream.leafNode('pane', {\r\n          xSplit: model.xSplit || undefined,\r\n          ySplit: model.ySplit || undefined,\r\n          topLeftCell: model.topLeftCell,\r\n          activePane: model.activePane,\r\n        });\r\n        xmlStream.leafNode('selection', {\r\n          pane: model.activePane,\r\n          activeCell: model.activeCell,\r\n          sqref: model.activeCell,\r\n        });\r\n        break;\r\n      case 'normal':\r\n        if (model.activeCell) {\r\n          xmlStream.leafNode('selection', {\r\n            activeCell: model.activeCell,\r\n            sqref: model.activeCell,\r\n          });\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    xmlStream.closeNode();\r\n  }\r\n\r\n  parseOpen(node) {\r\n    switch (node.name) {\r\n      case 'sheetView':\r\n        this.sheetView = {\r\n          workbookViewId: parseInt(node.attributes.workbookViewId, 10),\r\n          rightToLeft: node.attributes.rightToLeft === '1',\r\n          tabSelected: node.attributes.tabSelected === '1',\r\n          showRuler: !(node.attributes.showRuler === '0'),\r\n          showRowColHeaders: !(node.attributes.showRowColHeaders === '0'),\r\n          showGridLines: !(node.attributes.showGridLines === '0'),\r\n          zoomScale: parseInt(node.attributes.zoomScale || '100', 10),\r\n          zoomScaleNormal: parseInt(node.attributes.zoomScaleNormal || '100', 10),\r\n          style: node.attributes.view,\r\n        };\r\n        this.pane = undefined;\r\n        this.selections = {};\r\n        return true;\r\n\r\n      case 'pane':\r\n        this.pane = {\r\n          xSplit: parseInt(node.attributes.xSplit || '0', 10),\r\n          ySplit: parseInt(node.attributes.ySplit || '0', 10),\r\n          topLeftCell: node.attributes.topLeftCell,\r\n          activePane: node.attributes.activePane || 'topLeft',\r\n          state: node.attributes.state,\r\n        };\r\n        return true;\r\n\r\n      case 'selection': {\r\n        const name = node.attributes.pane || 'topLeft';\r\n        this.selections[name] = {\r\n          pane: name,\r\n          activeCell: node.attributes.activeCell,\r\n        };\r\n        return true;\r\n      }\r\n\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  parseText() {}\r\n\r\n  parseClose(name) {\r\n    let model;\r\n    let selection;\r\n    switch (name) {\r\n      case 'sheetView':\r\n        if (this.sheetView && this.pane) {\r\n          model = this.model = {\r\n            workbookViewId: this.sheetView.workbookViewId,\r\n            rightToLeft: this.sheetView.rightToLeft,\r\n            state: VIEW_STATES[this.pane.state] || 'split', // split is default\r\n            xSplit: this.pane.xSplit,\r\n            ySplit: this.pane.ySplit,\r\n            topLeftCell: this.pane.topLeftCell,\r\n            showRuler: this.sheetView.showRuler,\r\n            showRowColHeaders: this.sheetView.showRowColHeaders,\r\n            showGridLines: this.sheetView.showGridLines,\r\n            zoomScale: this.sheetView.zoomScale,\r\n            zoomScaleNormal: this.sheetView.zoomScaleNormal,\r\n          };\r\n          if (this.model.state === 'split') {\r\n            model.activePane = this.pane.activePane;\r\n          }\r\n          selection = this.selections[this.pane.activePane];\r\n          if (selection && selection.activeCell) {\r\n            model.activeCell = selection.activeCell;\r\n          }\r\n          if (this.sheetView.style) {\r\n            model.style = this.sheetView.style;\r\n          }\r\n        } else {\r\n          model = this.model = {\r\n            workbookViewId: this.sheetView.workbookViewId,\r\n            rightToLeft: this.sheetView.rightToLeft,\r\n            state: 'normal',\r\n            showRuler: this.sheetView.showRuler,\r\n            showRowColHeaders: this.sheetView.showRowColHeaders,\r\n            showGridLines: this.sheetView.showGridLines,\r\n            zoomScale: this.sheetView.zoomScale,\r\n            zoomScaleNormal: this.sheetView.zoomScaleNormal,\r\n          };\r\n          selection = this.selections.topLeft;\r\n          if (selection && selection.activeCell) {\r\n            model.activeCell = selection.activeCell;\r\n          }\r\n          if (this.sheetView.style) {\r\n            model.style = this.sheetView.style;\r\n          }\r\n        }\r\n        return false;\r\n      default:\r\n        return true;\r\n    }\r\n  }\r\n\r\n  reconcile() {}\r\n}\r\n\r\nmodule.exports = SheetViewXform;\r\n"],"mappings":"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"}