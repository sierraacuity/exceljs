{"version":3,"file":"cell-matrix.js","names":["_","require","colCache","CellMatrix","template","_classCallCheck","sheets","_createClass","key","value","addCell","addressStr","addCellEx","decodeEx","getCell","findCellEx","findCell","findCellAt","sheetName","rowNumber","colNumber","sheet","row","address","top","bottom","col","left","right","getCellAt","getCellEx","create","findSheet","findSheetRow","findRowCell","cell","n2l","removeCellEx","forEachInSheet","callback","forEach","_this","each","map","results","push","name","undefined","Object","assign","JSON","parse","stringify","spliceRows","start","numDelete","numInsert","inserts","i","splice","apply","concat","spliceColumns","module","exports"],"sources":["../../../lib/utils/cell-matrix.js"],"sourcesContent":["const _ = require('./under-dash');\r\nconst colCache = require('./col-cache');\r\n\r\nclass CellMatrix {\r\n  constructor(template) {\r\n    this.template = template;\r\n    this.sheets = {};\r\n  }\r\n\r\n  addCell(addressStr) {\r\n    this.addCellEx(colCache.decodeEx(addressStr));\r\n  }\r\n\r\n  getCell(addressStr) {\r\n    return this.findCellEx(colCache.decodeEx(addressStr), true);\r\n  }\r\n\r\n  findCell(addressStr) {\r\n    return this.findCellEx(colCache.decodeEx(addressStr), false);\r\n  }\r\n\r\n  findCellAt(sheetName, rowNumber, colNumber) {\r\n    const sheet = this.sheets[sheetName];\r\n    const row = sheet && sheet[rowNumber];\r\n    return row && row[colNumber];\r\n  }\r\n\r\n  addCellEx(address) {\r\n    if (address.top) {\r\n      for (let row = address.top; row <= address.bottom; row++) {\r\n        for (let col = address.left; col <= address.right; col++) {\r\n          this.getCellAt(address.sheetName, row, col);\r\n        }\r\n      }\r\n    } else {\r\n      this.findCellEx(address, true);\r\n    }\r\n  }\r\n\r\n  getCellEx(address) {\r\n    return this.findCellEx(address, true);\r\n  }\r\n\r\n  findCellEx(address, create) {\r\n    const sheet = this.findSheet(address, create);\r\n    const row = this.findSheetRow(sheet, address, create);\r\n    return this.findRowCell(row, address, create);\r\n  }\r\n\r\n  getCellAt(sheetName, rowNumber, colNumber) {\r\n    const sheet = this.sheets[sheetName] || (this.sheets[sheetName] = []);\r\n    const row = sheet[rowNumber] || (sheet[rowNumber] = []);\r\n    const cell =\r\n      row[colNumber] ||\r\n      (row[colNumber] = {\r\n        sheetName,\r\n        address: colCache.n2l(colNumber) + rowNumber,\r\n        row: rowNumber,\r\n        col: colNumber,\r\n      });\r\n    return cell;\r\n  }\r\n\r\n  removeCellEx(address) {\r\n    const sheet = this.findSheet(address);\r\n    if (!sheet) {\r\n      return;\r\n    }\r\n    const row = this.findSheetRow(sheet, address);\r\n    if (!row) {\r\n      return;\r\n    }\r\n    delete row[address.col];\r\n  }\r\n\r\n  forEachInSheet(sheetName, callback) {\r\n    const sheet = this.sheets[sheetName];\r\n    if (sheet) {\r\n      sheet.forEach((row, rowNumber) => {\r\n        if (row) {\r\n          row.forEach((cell, colNumber) => {\r\n            if (cell) {\r\n              callback(cell, rowNumber, colNumber);\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  forEach(callback) {\r\n    _.each(this.sheets, (sheet, sheetName) => {\r\n      this.forEachInSheet(sheetName, callback);\r\n    });\r\n  }\r\n\r\n  map(callback) {\r\n    const results = [];\r\n    this.forEach(cell => {\r\n      results.push(callback(cell));\r\n    });\r\n    return results;\r\n  }\r\n\r\n  findSheet(address, create) {\r\n    const name = address.sheetName;\r\n    if (this.sheets[name]) {\r\n      return this.sheets[name];\r\n    }\r\n    if (create) {\r\n      return (this.sheets[name] = []);\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  findSheetRow(sheet, address, create) {\r\n    const {row} = address;\r\n    if (sheet && sheet[row]) {\r\n      return sheet[row];\r\n    }\r\n    if (create) {\r\n      return (sheet[row] = []);\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  findRowCell(row, address, create) {\r\n    const {col} = address;\r\n    if (row && row[col]) {\r\n      return row[col];\r\n    }\r\n    if (create) {\r\n      return (row[col] = this.template\r\n        ? Object.assign(address, JSON.parse(JSON.stringify(this.template)))\r\n        : address);\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  spliceRows(sheetName, start, numDelete, numInsert) {\r\n    const sheet = this.sheets[sheetName];\r\n    if (sheet) {\r\n      const inserts = [];\r\n      for (let i = 0; i < numInsert; i++) {\r\n        inserts.push([]);\r\n      }\r\n      sheet.splice(start, numDelete, ...inserts);\r\n    }\r\n  }\r\n\r\n  spliceColumns(sheetName, start, numDelete, numInsert) {\r\n    const sheet = this.sheets[sheetName];\r\n    if (sheet) {\r\n      const inserts = [];\r\n      for (let i = 0; i < numInsert; i++) {\r\n        inserts.push(null);\r\n      }\r\n      _.each(sheet, row => {\r\n        row.splice(start, numDelete, ...inserts);\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = CellMatrix;\r\n"],"mappings":"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"}