{"version":3,"file":"phonetic-text-xform.js","names":["TextXform","require","RichTextXform","BaseXform","PhoneticTextXform","_BaseXform","_inherits","_super","_createSuper","_this","_classCallCheck","call","map","r","t","_createClass","key","get","value","render","xmlStream","model","openNode","tag","sb","eb","hasOwnProperty","richText","forEach","text","closeNode","parseOpen","node","name","parser","parseInt","attributes","parseText","parseClose","rt","push","undefined","module","exports"],"sources":["../../../../../lib/xlsx/xform/strings/phonetic-text-xform.js"],"sourcesContent":["const TextXform = require('./text-xform');\r\nconst RichTextXform = require('./rich-text-xform');\r\n\r\nconst BaseXform = require('../base-xform');\r\n\r\n// <rPh sb=\"0\" eb=\"1\">\r\n//   <t>(its pronounciation in KATAKANA)</t>\r\n// </rPh>\r\n\r\nclass PhoneticTextXform extends BaseXform {\r\n  constructor() {\r\n    super();\r\n\r\n    this.map = {\r\n      r: new RichTextXform(),\r\n      t: new TextXform(),\r\n    };\r\n  }\r\n\r\n  get tag() {\r\n    return 'rPh';\r\n  }\r\n\r\n  render(xmlStream, model) {\r\n    xmlStream.openNode(this.tag, {\r\n      sb: model.sb || 0,\r\n      eb: model.eb || 0,\r\n    });\r\n    if (model && model.hasOwnProperty('richText') && model.richText) {\r\n      const {r} = this.map;\r\n      model.richText.forEach(text => {\r\n        r.render(xmlStream, text);\r\n      });\r\n    } else if (model) {\r\n      this.map.t.render(xmlStream, model.text);\r\n    }\r\n    xmlStream.closeNode();\r\n  }\r\n\r\n  parseOpen(node) {\r\n    const {name} = node;\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n    if (name === this.tag) {\r\n      this.model = {\r\n        sb: parseInt(node.attributes.sb, 10),\r\n        eb: parseInt(node.attributes.eb, 10),\r\n      };\r\n      return true;\r\n    }\r\n    this.parser = this.map[name];\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  parseText(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  }\r\n\r\n  parseClose(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        switch (name) {\r\n          case 'r': {\r\n            let rt = this.model.richText;\r\n            if (!rt) {\r\n              rt = this.model.richText = [];\r\n            }\r\n            rt.push(this.parser.model);\r\n            break;\r\n          }\r\n          case 't':\r\n            this.model.text = this.parser.model;\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n        this.parser = undefined;\r\n      }\r\n      return true;\r\n    }\r\n    switch (name) {\r\n      case this.tag:\r\n        return false;\r\n      default:\r\n        return true;\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = PhoneticTextXform;\r\n"],"mappings":"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"}