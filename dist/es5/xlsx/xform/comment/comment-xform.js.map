{"version":3,"file":"comment-xform.js","names":["RichTextXform","require","utils","BaseXform","CommentXform","module","exports","model","inherits","tag","richTextXform","_richTextXform","render","xmlStream","_this","openNode","ref","authorId","note","texts","forEach","text","closeNode","parseOpen","node","parser","name","_objectSpread","type","attributes","parseText","parseClose","push","undefined"],"sources":["../../../../../lib/xlsx/xform/comment/comment-xform.js"],"sourcesContent":["const RichTextXform = require('../strings/rich-text-xform');\r\nconst utils = require('../../../utils/utils');\r\nconst BaseXform = require('../base-xform');\r\n\r\n/**\r\n  <comment ref=\"B1\" authorId=\"0\">\r\n    <text>\r\n      <r>\r\n        <rPr>\r\n          <b/>\r\n          <sz val=\"9\"/>\r\n          <rFont val=\"宋体\"/>\r\n          <charset val=\"134\"/>\r\n        </rPr>\r\n        <t>51422:</t>\r\n      </r>\r\n      <r>\r\n        <rPr>\r\n          <sz val=\"9\"/>\r\n          <rFont val=\"宋体\"/>\r\n          <charset val=\"134\"/>\r\n        </rPr>\r\n        <t xml:space=\"preserve\">&#10;test</t>\r\n      </r>\r\n    </text>\r\n  </comment>\r\n */\r\n\r\nconst CommentXform = (module.exports = function(model) {\r\n  this.model = model;\r\n});\r\n\r\nutils.inherits(CommentXform, BaseXform, {\r\n  get tag() {\r\n    return 'r';\r\n  },\r\n\r\n  get richTextXform() {\r\n    if (!this._richTextXform) {\r\n      this._richTextXform = new RichTextXform();\r\n    }\r\n    return this._richTextXform;\r\n  },\r\n\r\n  render(xmlStream, model) {\r\n    model = model || this.model;\r\n\r\n    xmlStream.openNode('comment', {\r\n      ref: model.ref,\r\n      authorId: 0,\r\n    });\r\n    xmlStream.openNode('text');\r\n    if (model && model.note && model.note.texts) {\r\n      model.note.texts.forEach(text => {\r\n        this.richTextXform.render(xmlStream, text);\r\n      });\r\n    }\r\n    xmlStream.closeNode();\r\n    xmlStream.closeNode();\r\n  },\r\n\r\n  parseOpen(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n    switch (node.name) {\r\n      case 'comment':\r\n        this.model = {\r\n          type: 'note',\r\n          note: {\r\n            texts: [],\r\n          },\r\n          ...node.attributes,\r\n        };\r\n        return true;\r\n      case 'r':\r\n        this.parser = this.richTextXform;\r\n        this.parser.parseOpen(node);\r\n        return true;\r\n      default:\r\n        return false;\r\n    }\r\n  },\r\n  parseText(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  },\r\n  parseClose(name) {\r\n    switch (name) {\r\n      case 'comment':\r\n        return false;\r\n      case 'r':\r\n        this.model.note.texts.push(this.parser.model);\r\n        this.parser = undefined;\r\n        return true;\r\n      default:\r\n        if (this.parser) {\r\n          this.parser.parseClose(name);\r\n        }\r\n        return true;\r\n    }\r\n  },\r\n});\r\n"],"mappings":"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"}