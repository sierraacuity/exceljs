{"version":3,"file":"core-xform.js","names":["XmlStream","require","BaseXform","DateXform","StringXform","IntegerXform","CoreXform","_BaseXform","_inherits","_super","_createSuper","_this","_classCallCheck","call","map","tag","format","DateFormat","attrs","DateAttrs","_createClass","key","value","render","xmlStream","model","openXml","StdDocAttributes","openNode","CORE_PROPERTY_ATTRIBUTES","creator","title","subject","description","identifier","language","keywords","category","lastModifiedBy","lastPrinted","revision","version","contentStatus","contentType","created","modified","closeNode","parseOpen","node","parser","name","Error","concat","JSON","stringify","parseText","text","parseClose","undefined","dt","toISOString","replace","module","exports"],"sources":["../../../../../lib/xlsx/xform/core/core-xform.js"],"sourcesContent":["const XmlStream = require('../../../utils/xml-stream');\r\nconst BaseXform = require('../base-xform');\r\nconst DateXform = require('../simple/date-xform');\r\nconst StringXform = require('../simple/string-xform');\r\nconst IntegerXform = require('../simple/integer-xform');\r\n\r\nclass CoreXform extends BaseXform {\r\n  constructor() {\r\n    super();\r\n\r\n    this.map = {\r\n      'dc:creator': new StringXform({tag: 'dc:creator'}),\r\n      'dc:title': new StringXform({tag: 'dc:title'}),\r\n      'dc:subject': new StringXform({tag: 'dc:subject'}),\r\n      'dc:description': new StringXform({tag: 'dc:description'}),\r\n      'dc:identifier': new StringXform({tag: 'dc:identifier'}),\r\n      'dc:language': new StringXform({tag: 'dc:language'}),\r\n      'cp:keywords': new StringXform({tag: 'cp:keywords'}),\r\n      'cp:category': new StringXform({tag: 'cp:category'}),\r\n      'cp:lastModifiedBy': new StringXform({tag: 'cp:lastModifiedBy'}),\r\n      'cp:lastPrinted': new DateXform({tag: 'cp:lastPrinted', format: CoreXform.DateFormat}),\r\n      'cp:revision': new IntegerXform({tag: 'cp:revision'}),\r\n      'cp:version': new StringXform({tag: 'cp:version'}),\r\n      'cp:contentStatus': new StringXform({tag: 'cp:contentStatus'}),\r\n      'cp:contentType': new StringXform({tag: 'cp:contentType'}),\r\n      'dcterms:created': new DateXform({\r\n        tag: 'dcterms:created',\r\n        attrs: CoreXform.DateAttrs,\r\n        format: CoreXform.DateFormat,\r\n      }),\r\n      'dcterms:modified': new DateXform({\r\n        tag: 'dcterms:modified',\r\n        attrs: CoreXform.DateAttrs,\r\n        format: CoreXform.DateFormat,\r\n      }),\r\n    };\r\n  }\r\n\r\n  render(xmlStream, model) {\r\n    xmlStream.openXml(XmlStream.StdDocAttributes);\r\n\r\n    xmlStream.openNode('cp:coreProperties', CoreXform.CORE_PROPERTY_ATTRIBUTES);\r\n\r\n    this.map['dc:creator'].render(xmlStream, model.creator);\r\n    this.map['dc:title'].render(xmlStream, model.title);\r\n    this.map['dc:subject'].render(xmlStream, model.subject);\r\n    this.map['dc:description'].render(xmlStream, model.description);\r\n    this.map['dc:identifier'].render(xmlStream, model.identifier);\r\n    this.map['dc:language'].render(xmlStream, model.language);\r\n    this.map['cp:keywords'].render(xmlStream, model.keywords);\r\n    this.map['cp:category'].render(xmlStream, model.category);\r\n    this.map['cp:lastModifiedBy'].render(xmlStream, model.lastModifiedBy);\r\n    this.map['cp:lastPrinted'].render(xmlStream, model.lastPrinted);\r\n    this.map['cp:revision'].render(xmlStream, model.revision);\r\n    this.map['cp:version'].render(xmlStream, model.version);\r\n    this.map['cp:contentStatus'].render(xmlStream, model.contentStatus);\r\n    this.map['cp:contentType'].render(xmlStream, model.contentType);\r\n    this.map['dcterms:created'].render(xmlStream, model.created);\r\n    this.map['dcterms:modified'].render(xmlStream, model.modified);\r\n\r\n    xmlStream.closeNode();\r\n  }\r\n\r\n  parseOpen(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n    switch (node.name) {\r\n      case 'cp:coreProperties':\r\n      case 'coreProperties':\r\n        return true;\r\n      default:\r\n        this.parser = this.map[node.name];\r\n        if (this.parser) {\r\n          this.parser.parseOpen(node);\r\n          return true;\r\n        }\r\n        throw new Error(`Unexpected xml node in parseOpen: ${JSON.stringify(node)}`);\r\n    }\r\n  }\r\n\r\n  parseText(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  }\r\n\r\n  parseClose(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.parser = undefined;\r\n      }\r\n      return true;\r\n    }\r\n    switch (name) {\r\n      case 'cp:coreProperties':\r\n      case 'coreProperties':\r\n        this.model = {\r\n          creator: this.map['dc:creator'].model,\r\n          title: this.map['dc:title'].model,\r\n          subject: this.map['dc:subject'].model,\r\n          description: this.map['dc:description'].model,\r\n          identifier: this.map['dc:identifier'].model,\r\n          language: this.map['dc:language'].model,\r\n          keywords: this.map['cp:keywords'].model,\r\n          category: this.map['cp:category'].model,\r\n          lastModifiedBy: this.map['cp:lastModifiedBy'].model,\r\n          lastPrinted: this.map['cp:lastPrinted'].model,\r\n          revision: this.map['cp:revision'].model,\r\n          contentStatus: this.map['cp:contentStatus'].model,\r\n          contentType: this.map['cp:contentType'].model,\r\n          created: this.map['dcterms:created'].model,\r\n          modified: this.map['dcterms:modified'].model,\r\n        };\r\n        return false;\r\n      default:\r\n        throw new Error(`Unexpected xml node in parseClose: ${name}`);\r\n    }\r\n  }\r\n}\r\n\r\nCoreXform.DateFormat = function(dt) {\r\n  return dt.toISOString().replace(/[.]\\d{3}/, '');\r\n};\r\nCoreXform.DateAttrs = {'xsi:type': 'dcterms:W3CDTF'};\r\n\r\nCoreXform.CORE_PROPERTY_ATTRIBUTES = {\r\n  'xmlns:cp': 'http://schemas.openxmlformats.org/package/2006/metadata/core-properties',\r\n  'xmlns:dc': 'http://purl.org/dc/elements/1.1/',\r\n  'xmlns:dcterms': 'http://purl.org/dc/terms/',\r\n  'xmlns:dcmitype': 'http://purl.org/dc/dcmitype/',\r\n  'xmlns:xsi': 'http://www.w3.org/2001/XMLSchema-instance',\r\n};\r\n\r\nmodule.exports = CoreXform;\r\n"],"mappings":"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"}