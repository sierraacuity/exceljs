{"version":3,"file":"sheet-rels-writer.js","names":["utils","require","RelType","HyperlinksProxy","sheetRelsWriter","_classCallCheck","writer","_createClass","key","value","push","hyperlink","addHyperlink","SheetRelsWriter","options","id","count","_hyperlinks","_workbook","workbook","get","_stream","_openStream","concat","length","each","fn","forEach","_hyperlinksProxy","relationship","Target","target","Type","Hyperlink","TargetMode","rId","_writeRelationship","address","addMedia","media","addRelationship","rel","commit","_writeClose","stream","end","_writeOpen","write","xmlEncode","module","exports"],"sources":["../../../../lib/stream/xlsx/sheet-rels-writer.js"],"sourcesContent":["/* eslint-disable max-classes-per-file */\r\nconst utils = require('../../utils/utils');\r\nconst RelType = require('../../xlsx/rel-type');\r\n\r\nclass HyperlinksProxy {\r\n  constructor(sheetRelsWriter) {\r\n    this.writer = sheetRelsWriter;\r\n  }\r\n\r\n  push(hyperlink) {\r\n    this.writer.addHyperlink(hyperlink);\r\n  }\r\n}\r\n\r\nclass SheetRelsWriter {\r\n  constructor(options) {\r\n    // in a workbook, each sheet will have a number\r\n    this.id = options.id;\r\n\r\n    // count of all relationships\r\n    this.count = 0;\r\n\r\n    // keep record of all hyperlinks\r\n    this._hyperlinks = [];\r\n\r\n    this._workbook = options.workbook;\r\n  }\r\n\r\n  get stream() {\r\n    if (!this._stream) {\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      this._stream = this._workbook._openStream(`/xl/worksheets/_rels/sheet${this.id}.xml.rels`);\r\n    }\r\n    return this._stream;\r\n  }\r\n\r\n  get length() {\r\n    return this._hyperlinks.length;\r\n  }\r\n\r\n  each(fn) {\r\n    return this._hyperlinks.forEach(fn);\r\n  }\r\n\r\n  get hyperlinksProxy() {\r\n    return this._hyperlinksProxy || (this._hyperlinksProxy = new HyperlinksProxy(this));\r\n  }\r\n\r\n  addHyperlink(hyperlink) {\r\n    // Write to stream\r\n    const relationship = {\r\n      Target: hyperlink.target,\r\n      Type: RelType.Hyperlink,\r\n      TargetMode: 'External',\r\n    };\r\n    const rId = this._writeRelationship(relationship);\r\n\r\n    // store sheet stuff for later\r\n    this._hyperlinks.push({\r\n      rId,\r\n      address: hyperlink.address,\r\n    });\r\n  }\r\n\r\n  addMedia(media) {\r\n    return this._writeRelationship(media);\r\n  }\r\n\r\n  addRelationship(rel) {\r\n    return this._writeRelationship(rel);\r\n  }\r\n\r\n  commit() {\r\n    if (this.count) {\r\n      // write xml utro\r\n      this._writeClose();\r\n      // and close stream\r\n      this.stream.end();\r\n    }\r\n  }\r\n\r\n  // ================================================================================\r\n  _writeOpen() {\r\n    this.stream.write(\r\n      `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\r\n       <Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">`\r\n    );\r\n  }\r\n\r\n  _writeRelationship(relationship) {\r\n    if (!this.count) {\r\n      this._writeOpen();\r\n    }\r\n\r\n    const rId = `rId${++this.count}`;\r\n\r\n    if (relationship.TargetMode) {\r\n      this.stream.write(\r\n        `<Relationship Id=\"${rId}\"` +\r\n          ` Type=\"${relationship.Type}\"` +\r\n          ` Target=\"${utils.xmlEncode(relationship.Target)}\"` +\r\n          ` TargetMode=\"${relationship.TargetMode}\"` +\r\n          '/>'\r\n      );\r\n    } else {\r\n      this.stream.write(\r\n        `<Relationship Id=\"${rId}\" Type=\"${relationship.Type}\" Target=\"${relationship.Target}\"/>`\r\n      );\r\n    }\r\n\r\n    return rId;\r\n  }\r\n\r\n  _writeClose() {\r\n    this.stream.write('</Relationships>');\r\n  }\r\n}\r\n\r\nmodule.exports = SheetRelsWriter;\r\n"],"mappings":"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"}